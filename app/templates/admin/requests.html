<h3>Patient Requests</h3>
{% if pending_requests %}
<table class="table table-bordered">
    <thead>
        <tr>
            <th>Patient Name</th>
            <th>Request Type</th>
            <th>Details</th>
            <th>Submitted At</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
    {% for req in pending_requests %}
        <tr>
            <td>{{ req.patient.full_name() }}</td>
            <td>{{ req.request_type }}</td>
            <td>{{ req.details }}</td>
            <td>{{ req.created_at.strftime("%Y-%m-%d %H:%M") }}</td>
            <td>
                <!-- Update Status Button triggers modal -->
                <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#updateRequestModal{{ req.id }}">
                    Update Status
                </button>

                <!-- Modal -->
                <div class="modal fade" id="updateRequestModal{{ req.id }}" tabindex="-1">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <form action="{{ url_for('admin.update_request', request_id=req.id) }}" method="POST">
                        <div class="modal-header">
                          <h5 class="modal-title">Update Request #{{ req.id }}</h5>
                          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                          <div class="mb-3">
                            <label>Status</label>
                            <select name="status" class="form-control" required>
                              <option value="Granted">Granted</option>
                              <option value="Denied">Denied</option>
                            </select>
                          </div>
                          <div class="mb-3">
                            <label>Note (optional)</label>
                            <textarea name="admin_note" class="form-control" rows="3"></textarea>
                          </div>
                        </div>
                        <div class="modal-footer">
                          <button type="submit" class="btn btn-success">Save</button>
                          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
            </td>
        </tr>
    {% endfor %}
    </tbody>
</table>
{% else %}
<p>No pending requests.</p>
{% endif %}
