{% extends "base.html" %}
{% block title %}Family History â€“ {{ patient.full_name() }}{% endblock %}

{% block content %}
<div class="card shadow-sm form-card">
  <div class="card-header bg-primary text-white">
    <h4 class="mb-0">
      Family Medical History for <strong>{{ patient.full_name() }}</strong>
    </h4>
  </div>

  <div class="card-body">
    <form method="POST" novalidate>
      

      <!-- Checkbox Grid -->
      <div class="mb-4">
        <p class="text-muted mb-3">Select all that apply in the family:</p>
        <div class="row g-3">
          {% set conditions = [
            ('hypertension', 'Hypertension'),
            ('diabetes', 'Diabetes'),
            ('cancer', 'Cancer'),
            ('heart_disease', 'Heart Disease'),
            ('stroke', 'Stroke'),
            ('sickle_cell', 'Sickle Cell'),
            ('tuberculosis', 'Tuberculosis'),
            ('asthma', 'Asthma'),
            ('mental_illness', 'Mental Illness')
          ] %}

          {% for name, label in conditions %}
            {% set fh = patient.family_history %}
            <div class="col-6 col-md-4">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" 
                       name="{{ name }}" id="{{ name }}"
                       {% if fh and getattr(fh, name, False) %}checked{% endif %}>
                <label class="form-check-label fw-medium" for="{{ name }}">
                  {{ label }}
                </label>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>

      <!-- Other Conditions -->
      <div class="mb-4">
        <label for="other_conditions" class="form-label">Other Conditions</label>
        <textarea 
          class="form-control" 
          id="other_conditions" 
          name="other_conditions" 
          rows="3" 
          placeholder="e.g., Epilepsy, Kidney disease, etc."
        >{{ (patient.family_history.other_conditions or '')|e }}</textarea>
        <div class="form-text">Add any other relevant family medical conditions.</div>
      </div>

      <!-- Action Buttons -->
      <div class="d-flex gap-2 justify-content-end">
        <a href="{{ url_for('patients.patient_detail', patient_id=patient.id) }}" 
           class="btn btn-outline-secondary btn-save">
          Cancel
        </a>
        <button type="submit" class="btn btn-primary btn-save">
          Save History
        </button>
      </div>
    </form>
  </div>
</div>
{% endblock %}